<%- layout('layouts/main.ejs') %>

<div class="card p-4 mx-auto" style="width: 28rem;"> 
    <h3 class="card-title text-center">Upload song</h3>
    <div class="card-body">
        <form action="/upload_track" method="post" enctype="multipart/form-data">
            <!-- File -->
            <div class="mb-3">
                <label class="form-label">Select file</label>
                <input type="file" class="form-control" name="track" id="upload-file">
            </div>
            <!-- Track name -->
            <div class="mb-3">
                <label class="form-label">Name</label>
                <input type="text" class="form-control" name="name" id="filename">
            </div>
            <!-- Labels -->
            <% if(labels.length == 0){ %> <!-- If no labels -->
                <div class="card">
                    <div class="card-body text-center">
                        <h5 class="card-title">No labels yet</h5>
                        <a href="/add_label" class="btn btn-primary">Add new label</a>
                    </div>
                </div>
            <% } else{ %>  <!-- If labels -->
                <div class="list-group mb-3">
                    <label class="form-label">Add labels</label>
                    <% labels.forEach(function(label){ %>
                    <label class="list-group-item" id="<%= label.id %>-label">
                        <input class="form-check-input me-1" type="checkbox" name="<%= label.id %>" id="<%= label.id %>" onclick="check(this.id)" style="display:none">
                        <%= label.label %>
                    </label>
                    <% }); %>
                </div>
            <script> 
                function check(id) {
                    var label= document.getElementById(id+"-label")
                    var checkbox= document.getElementById(id)
                    if(checkbox.checked){
                        label.classList.add("list-group-item","active")
                        console.log("checked")
                    }
                    else{
                        console.log("unchecked")
                        label.classList.remove("active")   
                    }
                }
            </script>
            <% } %>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>
</div>

<script>
    //Get fields
    var fileInput = document.getElementById('upload-file');
    var nameInput = document.getElementById('filename');

    //The change event gives us the input it occurred in 
    fileInput.addEventListener('change', (event) => {
        //Get input
        var input = event.srcElement;
        //Get name from file and remove extension
        var fileName = input.files[0].name.split(".")[[0]];
        //Write filename in Name field
        nameInput.value = fileName;
    });
</script>